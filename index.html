<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pot Noodle App</title>
  <meta name="description" content="A fun, interactive Pot Noodle cooking helper with step-by-step timers." />
  <style>
    :root{
      --bg:#0b0f17;
      --card:#111827;
      --card2:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#fbbf24;
      --accent2:#60a5fa;
      --good:#34d399;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 30% 10%, rgba(251,191,36,.18), transparent 60%),
                  radial-gradient(900px 700px at 80% 30%, rgba(96,165,250,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}

    header{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      padding:16px 18px;
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:sticky;top:12px;backdrop-filter: blur(10px);
      z-index:10;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:conic-gradient(from 180deg, var(--accent), var(--accent2), var(--accent));
      display:grid;place-items:center;
      box-shadow: 0 10px 25px rgba(251,191,36,.18);
      border:1px solid rgba(255,255,255,.12);
    }
    .logo span{filter: drop-shadow(0 6px 14px rgba(0,0,0,.25)); font-size:20px}
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{margin:2px 0 0 0;color:var(--muted);font-size:12.5px}
    .pillrow{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      font-size:12px;color:rgba(255,255,255,.9);
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(17,24,39,.55);
    }

    .grid{display:grid;grid-template-columns: 1.1fr .9fr; gap:16px; margin-top:16px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    .card{
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:rgba(15,23,42,.55);
    }
    .card .bd{padding:14px 16px}
    .title{font-weight:700;font-size:14.5px}
    .tiny{font-size:12px;color:var(--muted)}

    .row{display:flex;gap:10px;flex-wrap:wrap}
    select, button, input[type="range"]{
      font:inherit;
    }
    select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(17,24,39,.65);
      color:var(--text);
      outline:none;
    }
    .controls{display:grid;grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    @media (max-width: 520px){.controls{grid-template-columns:1fr}}

    .seg{
      display:flex;gap:8px;flex-wrap:wrap;
      padding:10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(17,24,39,.5);
      border-radius:14px;
    }
    .seg button{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(15,23,42,.6);
      color:var(--text);
      padding:10px 10px;
      border-radius:12px;
      cursor:pointer;
      flex:1;
      min-width:120px;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
    }
    .seg button:hover{transform: translateY(-1px)}
    .seg button.active{
      border-color: rgba(251,191,36,.7);
      background: rgba(251,191,36,.12);
      box-shadow: 0 10px 25px rgba(251,191,36,.12);
    }

    .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button.primary{
      background:linear-gradient(180deg, rgba(251,191,36,.95), rgba(251,191,36,.72));
      border:none;color:#111827;
      padding:12px 14px;border-radius:14px;
      cursor:pointer;font-weight:800;
      box-shadow: 0 14px 35px rgba(251,191,36,.18);
    }
    button.ghost{
      background:rgba(17,24,39,.35);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:12px 14px;border-radius:14px;
      cursor:pointer;font-weight:650;
    }
    button:disabled{opacity:.55;cursor:not-allowed}

    .stepper{
      display:grid;gap:10px;
    }
    .step{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(17,24,39,.40);
      border-radius:16px;
      padding:12px;
      display:grid;gap:8px;
      position:relative;
      overflow:hidden;
    }
    .step.current{
      border-color: rgba(96,165,250,.65);
      box-shadow: 0 14px 35px rgba(96,165,250,.12);
      background: linear-gradient(180deg, rgba(96,165,250,.10), rgba(17,24,39,.35));
    }
    .step.done{
      border-color: rgba(52,211,153,.55);
      background: linear-gradient(180deg, rgba(52,211,153,.10), rgba(17,24,39,.35));
    }

    .stephd{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,23,42,.55);
      color:rgba(255,255,255,.92);
      white-space:nowrap;
    }
    .badge.good{border-color: rgba(52,211,153,.6);background: rgba(52,211,153,.10)}
    .badge.bad{border-color: rgba(251,113,133,.6);background: rgba(251,113,133,.10)}

    .desc{color:rgba(229,231,235,.95);line-height:1.4;font-size:14px}
    .muted{color:var(--muted)}

    .timer{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,23,42,.55);
    }
    .bigtime{font-variant-numeric: tabular-nums; font-size:26px; font-weight:900; letter-spacing:.5px}
    .tbtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .tbtns button{
      border-radius:12px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(17,24,39,.45);
      color:var(--text);
      cursor:pointer;
      font-weight:700;
    }

    .progress{
      height:10px;border-radius:999px;
      background:rgba(255,255,255,.08);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      transition: width .15s linear;
    }

    .toast{
      position:fixed;
      bottom:16px;left:50%;transform:translateX(-50%);
      background:rgba(17,24,39,.82);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      box-shadow: var(--shadow);
      opacity:0;pointer-events:none;
      transition: opacity .15s ease, transform .15s ease;
      z-index:999;
      max-width:min(92vw, 760px);
      text-overflow: ellipsis;
      overflow:hidden;
      white-space:nowrap;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}

    .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:998}
    .c{
      position:absolute;top:-10px;
      width:10px;height:14px;
      border-radius:3px;
      opacity:.95;
      animation: fall linear forwards;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.2));
    }
    @keyframes fall{
      to{transform: translateY(calc(100vh + 30px)) rotate(720deg); opacity:1}
    }

    .hint{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(17,24,39,.35);
      display:grid;gap:8px
    }
    .hint ul{margin:0;padding-left:18px;color:rgba(229,231,235,.92)}
    .hint li{margin:6px 0}

    .footerNote{margin-top:12px;color:var(--muted);font-size:12px;line-height:1.35}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,23,42,.55);
      color:rgba(255,255,255,.92)
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"><span>üçú</span></div>
        <div>
          <h1>Pot Noodle App</h1>
          <p class="sub">Pick your flavour ‚Ä¢ pick your vibe ‚Ä¢ follow the timers ‚Ä¢ eat like a legend</p>
        </div>
      </div>
      <div class="pillrow" aria-label="quick tips">
        <div class="pill">‚è±Ô∏è Step-by-step timers</div>
        <div class="pill">ü•£ Sloppy/Dry preference</div>
        <div class="pill">‚ú® Extra flavour hacks</div>
      </div>
    </header>

    <div class="grid">
      <section class="card" aria-label="setup">
        <div class="hd">
          <div>
            <div class="title">1) Choose your Pot</div>
            <div class="tiny">We‚Äôll build the right steps + timers for it.</div>
          </div>
          <div class="badge" id="packBadge">‚Äî</div>
        </div>
        <div class="bd">
          <label class="tiny" for="flavour">Flavour / product</label>
          <select id="flavour"></select>

          <div class="controls" style="margin-top:12px">
            <div>
              <div class="tiny">Cooking method</div>
              <div class="seg" id="methodSeg" role="tablist" aria-label="Cooking method"></div>
            </div>

            <div>
              <div class="tiny">Texture preference</div>
              <div class="seg" id="textureSeg" role="tablist" aria-label="Texture preference">
                <button type="button" data-texture="sloppy" class="active">ü•£ Sloppy</button>
                <button type="button" data-texture="classic">üëå Classic</button>
                <button type="button" data-texture="dry">üç¥ Dry</button>
              </div>
              <div class="tiny" style="margin-top:10px">Sauciness knob (just for fun)</div>
              <input id="sauceKnob" type="range" min="0" max="100" value="50" style="width:100%" />
            </div>
          </div>

          <div class="btnrow">
            <button class="primary" id="build">Build my steps</button>
            <button class="ghost" id="surprise">üé≤ Surprise me</button>
            <button class="ghost" id="resetAll">Reset</button>
          </div>

          <div class="footerNote">
            <strong>Heads up:</strong> Always follow the instructions on <em>your</em> pack if they differ. This app is a helper.
            Hot water + noodles = lava. ü•µ
          </div>
        </div>
      </section>

      <aside class="card" aria-label="hints">
        <div class="hd">
          <div>
            <div class="title">2) Extra flavour hacks</div>
            <div class="tiny">If you‚Äôre feeling chaotic-good.</div>
          </div>
          <div class="badge" id="hintBadge">‚ú®</div>
        </div>
        <div class="bd">
          <div class="hint">
            <div class="title" style="font-size:14px">For your selected flavour:</div>
            <div class="desc" id="flavourDesc">Pick a flavour to see what‚Äôs in the pot and the best add-ons.</div>
            <div class="progress" aria-hidden="true"><div class="bar" id="knobBar"></div></div>
            <div class="tiny">Your sauciness level: <span id="knobLabel">50</span>/100</div>
            <ul id="hintList"></ul>
            <div class="tiny muted" id="sachetNote"></div>
          </div>

          <div class="footerNote" style="margin-top:12px">
            Pro-tip: Keep a fork nearby. You‚Äôre about to become a <span class="kbd">stir-based athlete</span>.
          </div>
        </div>
      </aside>

      <section class="card" aria-label="steps" style="grid-column: 1 / -1;">
        <div class="hd">
          <div>
            <div class="title">3) Cook mode</div>
            <div class="tiny">Hit Start on each step. Auto-advances when a timer finishes.</div>
          </div>
          <div class="row">
            <div class="badge" id="statusBadge">Waiting‚Ä¶</div>
            <div class="badge" id="totalTimeBadge">Total: ‚Äî</div>
          </div>
        </div>
        <div class="bd">
          <div class="timer" aria-label="active timer">
            <div>
              <div class="tiny" id="activeStepName">No steps yet</div>
              <div class="bigtime" id="time">00:00</div>
              <div class="tiny muted" id="activeTip">Build steps to begin.</div>
            </div>
            <div class="tbtns">
              <button id="startPause" disabled>‚ñ∂ Start</button>
              <button id="skip" disabled>‚è≠ Skip</button>
              <button id="restart" disabled>‚Ü∫ Restart step</button>
              <button id="mute">üîä Sound on</button>
            </div>
          </div>

          <div style="margin-top:12px" class="progress" aria-label="timer progress"><div class="bar" id="progressBar"></div></div>

          <div style="margin-top:14px" class="stepper" id="stepper"></div>

          <div class="footerNote" style="margin-top:14px">
            Keyboard: <span class="kbd">Space</span> start/pause ‚Ä¢ <span class="kbd">‚Üí</span> skip ‚Ä¢ <span class="kbd">R</span> restart step ‚Ä¢ <span class="kbd">M</span> mute
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>
  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <script>
    // Pot Noodle App ‚Äî single-file, GitHub Pages friendly.
    // Data sources used to build these steps:
    // - Standard Pot Noodle pot prep pattern (boiling water to fill line, 2 min wait, stir, add sachet, 2 min wait):
    //   Unilever Food Solutions product pages (example: Chicken & Mushroom) show these preparation steps.
    // - "Lost the Pot Noodle" (packet) hob + microwave instructions:
    //   Tesco product page for Lost the Pot Smokin' BBQ lists hob + microwave methods.
    // - Flavour add-on tips:
    //   PotNoodle FAQ page lists extra tips for several flavours.

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const PRODUCTS = [
      // POT (in the pot)
      {
        id: 'pot_chicken_mushroom',
        name: 'Pot Noodle ‚Äî Chicken & Mushroom',
        type: 'pot',
        hasSachet: true,
        sachetLabel: 'Soy sauce sachet',
        description: 'Noodles in a chicken & mushroom flavour sauce with veggies, plus a little soy sauce sachet.',
        hints: ['Add some cheese for a melty, indulgent upgrade. üßÄ'],
        defaultMethod: 'kettle'
      },
      {
        id: 'pot_beef_tomato',
        name: 'Pot Noodle ‚Äî Beef & Tomato',
        type: 'pot',
        hasSachet: true,
        sachetLabel: 'Sauce sachet (varies by pack)',
        description: 'Beef & tomato vibes with dried veg. Sachet varies by pack ‚Äî check your lid! ',
        hints: ['Try adding croutons for extra bite. ü•ñ'],
        defaultMethod: 'kettle'
      },
      {
        id: 'pot_bombay_bad_boy',
        name: 'Pot Noodle ‚Äî Bombay Bad Boy',
        type: 'pot',
        hasSachet: true,
        sachetLabel: 'Hot sauce sachet (common)',
        description: 'Spicy curry-style noodles. If you‚Äôve got a sachet under the lid, you‚Äôre in business.',
        hints: ['Add extra hot chilli sauce if you can handle it. üå∂Ô∏è'],
        defaultMethod: 'kettle'
      },
      {
        id: 'pot_original_curry',
        name: 'Pot Noodle ‚Äî Original Curry',
        type: 'pot',
        hasSachet: true,
        sachetLabel: 'Sweet mango sauce sachet',
        description: 'Classic curry pot with a sweet mango sachet on many packs.',
        hints: ['Throw in some diced tomatoes to switch it up. üçÖ'],
        defaultMethod: 'kettle'
      },
      {
        id: 'pot_sweet_sour',
        name: 'Pot Noodle ‚Äî Sweet & Sour',
        type: 'pot',
        hasSachet: true,
        sachetLabel: 'Sweet & sour sauce sachet',
        description: 'Sweet & sour flavour sauce with veggies and a little extra sauce sachet.',
        hints: ['Add a splash of rice vinegar + spring onions if you‚Äôre feeling fancy. üßÖ'],
        defaultMethod: 'kettle'
      },
      {
        id: 'pot_sticky_rib',
        name: "Pot Noodle ‚Äî Sticky Rib",
        type: 'pot',
        hasSachet: true,
        sachetLabel: 'Sauce sachet (varies by pack)',
        description: 'Sticky, savoury, glorious. Check your lid for a sachet before you begin.',
        hints: ['Add a pinch of smoked paprika or BBQ sauce to lean into the vibe. üî•'],
        defaultMethod: 'kettle'
      },

      // LOST THE POT (packet; needs bowl/pan)
      {
        id: 'lost_smokin_bqq',
        name: "Lost the Pot ‚Äî Smokin' BBQ (packet)",
        type: 'lost',
        hasSachet: true,
        sachetLabel: 'Seasoning sachet',
        description: 'No pot. Big freedom. Cook on hob or microwave (in a microwave-safe dish).',
        hints: ['Add peas / carrots / stir-fry veg for instant grown-up points. ü•ï'],
        defaultMethod: 'microwave'
      },
      {
        id: 'lost_champion_chicken',
        name: "Lost the Pot ‚Äî Champion Chicken (packet)",
        type: 'lost',
        hasSachet: true,
        sachetLabel: 'Seasoning sachet',
        description: 'No pot. All power. Cook on hob or microwave (in a microwave-safe dish).',
        hints: ['Add shredded leftover roast chicken if you‚Äôve got it. üêî'],
        defaultMethod: 'microwave'
      },
    ];

    const METHODS = {
      kettle: {
        id: 'kettle',
        label: '‚ô®Ô∏è Kettle (boiling water)',
        allowedTypes: ['pot'],
      },
      microwave: {
        id: 'microwave',
        label: 'üì° Microwave (dish)',
        allowedTypes: ['lost'],
      },
      hob: {
        id: 'hob',
        label: 'üç≥ Hob (pan)',
        allowedTypes: ['lost'],
      },
    };

    const GENERAL_HACKS = [
      'Add a knob of butter for glossy sauce. üßà',
      'A squeeze of lime/lemon wakes it up. üçã',
      'Pinch of MSG (if you‚Äôre into science). üß™',
      'Crispy onions / chilli crisp = instant upgrade. üßÖüå∂Ô∏è',
      'Crack an egg in at the end and stir hard (only if it‚Äôs piping hot). ü•ö',
      'A few drops of sesame oil for ‚Äútakeaway aroma‚Äù. üå∞',
    ];

    const TIMEWELLSPENT = [
      'Practice your ‚Äústir face‚Äù in the mirror. üò§',
      'Perfect your fork twirl technique. üç¥',
      'Compose a haiku about noodles. üìù',
      'Do a heroic lap around the kitchen. üèÉ',
      'Text someone: ‚ÄúI‚Äôm busy. I‚Äôm cooking.‚Äù üíÖ',
      'Pretend you‚Äôre a TV chef. "Now we wait‚Ä¶" üì∫',
    ];

    // --- UI wiring ---
    const flavourSel = $('#flavour');
    const methodSeg = $('#methodSeg');
    const textureSeg = $('#textureSeg');
    const sauceKnob = $('#sauceKnob');

    const packBadge = $('#packBadge');
    const hintBadge = $('#hintBadge');
    const flavourDesc = $('#flavourDesc');
    const hintList = $('#hintList');
    const sachetNote = $('#sachetNote');

    const stepper = $('#stepper');
    const buildBtn = $('#build');
    const surpriseBtn = $('#surprise');
    const resetAllBtn = $('#resetAll');

    const statusBadge = $('#statusBadge');
    const totalTimeBadge = $('#totalTimeBadge');
    const activeStepName = $('#activeStepName');
    const timeEl = $('#time');
    const activeTip = $('#activeTip');
    const progressBar = $('#progressBar');
    const knobBar = $('#knobBar');
    const knobLabel = $('#knobLabel');

    const startPauseBtn = $('#startPause');
    const skipBtn = $('#skip');
    const restartBtn = $('#restart');
    const muteBtn = $('#mute');

    const toast = $('#toast');
    const confetti = $('#confetti');

    // --- state ---
    let state = {
      productId: PRODUCTS[0].id,
      method: PRODUCTS[0].defaultMethod,
      texture: 'sloppy',
      steps: [],
      stepIndex: 0,
      running: false,
      remaining: 0,
      duration: 0,
      tickHandle: null,
      muted: false,
      knob: 50,
    };

    function fmt(sec){
      sec = Math.max(0, Math.round(sec));
      const m = String(Math.floor(sec/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      return `${m}:${s}`;
    }

    function toastMsg(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> toast.classList.remove('show'), 2200);
    }

    function beep(type='done'){
      if(state.muted) return;
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = type==='done' ? 880 : 440;
        g.gain.value = 0.0001;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.22, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.18);
        o.stop(ctx.currentTime + 0.2);
        setTimeout(()=>ctx.close(), 260);
      } catch(e) {}
    }

    function spawnConfetti(){
      confetti.innerHTML = '';
      const n = 26;
      for(let i=0;i<n;i++){
        const el = document.createElement('div');
        el.className = 'c';
        el.style.left = Math.random()*100 + 'vw';
        el.style.animationDuration = (2.4 + Math.random()*1.4) + 's';
        el.style.transform = `translateY(-10px) rotate(${Math.random()*120}deg)`;
        // Let the browser pick default colors; we randomize via hsl to avoid hardcoding a palette.
        el.style.background = `hsl(${Math.floor(Math.random()*360)} 90% 65%)`;
        confetti.appendChild(el);
      }
      setTimeout(()=> confetti.innerHTML='', 3400);
    }

    function currentProduct(){
      return PRODUCTS.find(p => p.id === state.productId) || PRODUCTS[0];
    }

    function allowedMethodsFor(product){
      return Object.values(METHODS).filter(m => m.allowedTypes.includes(product.type));
    }

    function buildMethodButtons(){
      const p = currentProduct();
      const allowed = allowedMethodsFor(p);
      // If current method not allowed, snap to product default.
      if(!allowed.some(m => m.id === state.method)) state.method = p.defaultMethod;

      methodSeg.innerHTML = '';
      for(const m of allowed){
        const b = document.createElement('button');
        b.type = 'button';
        b.textContent = m.label;
        b.dataset.method = m.id;
        if(m.id === state.method) b.classList.add('active');
        b.addEventListener('click', () => {
          state.method = m.id;
          buildMethodButtons();
          toastMsg(`Method set: ${m.label}`);
        });
        methodSeg.appendChild(b);
      }
    }

    function updateHints(){
      const p = currentProduct();
      packBadge.textContent = p.type === 'pot' ? 'POT (in a pot)' : 'LOST THE POT (packet)';
      flavourDesc.textContent = p.description;

      hintList.innerHTML = '';
      const list = [];
      // Flavour-specific
      for(const h of p.hints || []) list.push(h);
      // Texture guidance
      if(state.texture === 'dry') list.push('Dry mode: aim just under the fill line / slightly less liquid.');
      if(state.texture === 'sloppy') list.push('Sloppy mode: go to the fill line (or a tiny splash above if your pack allows).');
      if(state.texture === 'classic') list.push('Classic mode: straight to the fill line and trust the process.');
      // Knob guidance
      if(state.knob >= 80) list.push('Sauciness 80+? Consider adding a splash of soy / chilli crisp / ketchup (choose your chaos).');
      if(state.knob <= 20) list.push('Sauciness 20-? Keep it tight: stir well and let it sit a touch longer.');
      // General hacks (random 2)
      const g = GENERAL_HACKS.slice().sort(()=>Math.random()-0.5).slice(0,2);
      list.push(...g);

      for(const item of list){
        const li = document.createElement('li');
        li.textContent = item;
        hintList.appendChild(li);
      }

      sachetNote.textContent = p.hasSachet
        ? `‚úÖ This one typically includes a sachet: ${p.sachetLabel}. (Always check your pack.)`
        : '‚ÑπÔ∏è No sachet expected (always check your pack).';

      knobLabel.textContent = String(state.knob);
      knobBar.style.width = state.knob + '%';
    }

    function setTexture(tex){
      state.texture = tex;
      $$('#textureSeg button').forEach(b => b.classList.toggle('active', b.dataset.texture === tex));
      updateHints();
    }

    function stepsFor(product, method){
      // We keep the official-ish structure, but add playful microcopy.
      // NOTE: Times come from cited sources (see top of file) where possible.
      // If you want to be extra accurate per flavour/size, you can extend this with per-pack overrides.

      const sauceMsg = (product.hasSachet)
        ? `Remove the sachet and keep it safe. (Do NOT eat it now. This is not that kind of app.)`
        : `No sachet? Cool. Your future self thanks you.`;

      // Texture tweaks (gentle): we do NOT claim exact ml changes; we phrase as guidance.
      const textureTip = (function(){
        if(state.texture==='dry') return 'Dry mode: aim slightly under the fill line (thicker sauce).';
        if(state.texture==='sloppy') return 'Sloppy mode: fill to the line (or a tiny splash more if you like it looser).';
        return 'Classic mode: fill to the line. No drama.';
      })();

      if(product.type === 'pot'){
        // Kettle method based on UFS preparation:
        // 1) Peel back lid halfway, remove sachet, pour boiling water to fill line, re-cover & leave 2 mins
        // 2) Stir in sachet contents, leave for another 2 mins
        // 3) Eat (do not reheat)
        return [
          {
            id:'open',
            name:'Peel lid + locate sachet',
            duration: 0,
            kind:'action',
            text: `Peel the lid back halfway. ${sauceMsg}`
          },
          {
            id:'water',
            name:'Add boiling water',
            duration: 0,
            kind:'action',
            text: `Pour boiling water in to the fill line. ${textureTip} Re-cover with the lid.`
          },
          {
            id:'wait1',
            name:'Wait (steam magic)',
            duration: 120,
            kind:'timer',
            text: `Leave it for 2 minutes. Time well spent: ${TIMEWELLSPENT[Math.floor(Math.random()*TIMEWELLSPENT.length)]}`
          },
          {
            id:'stir1',
            name:'Stir like you mean it',
            duration: 0,
            kind:'action',
            text: `Stir thoroughly. Scrape the corners. Free the flavour.`
          },
          {
            id:'sachet',
            name:'Add sachet',
            duration: 0,
            kind:'action',
            text: product.hasSachet
              ? `Add the sachet contents now (${product.sachetLabel}). Stir again.`
              : `If your pack has a sachet, add it now. If not, proceed. Stir again.`
          },
          {
            id:'wait2',
            name:'Wait (final form)',
            duration: 120,
            kind:'timer',
            text: `Leave for another 2 minutes. Your noodles are evolving‚Ä¶` + (state.texture==='dry' ? ' (Dry mode bonus: leave it an extra 20‚Äì30 seconds if you want it thicker.)' : '')
          },
          {
            id:'eat',
            name:'Eat while it‚Äôs hot',
            duration: 0,
            kind:'action',
            text: `Stir once more and tuck in. Warning: it will be hot. Victory tastes like noodles.`
          },
        ];
      }

      // LOST THE POT
      if(method === 'hob'){
        // Tesco: Add noodles to pan of 300ml boiling water; stir in sachet; reduce heat and simmer 3 mins until absorbed.
        return [
          {
            id:'pan',
            name:'Boil water in a pan',
            duration: 0,
            kind:'action',
            text: `Bring 300 ml of water to the boil in a pan.`
          },
          {
            id:'add',
            name:'Add noodles + sachet',
            duration: 0,
            kind:'action',
            text: `Add noodles. Stir in the sachet contents.`
          },
          {
            id:'simmer',
            name:'Simmer',
            duration: 180,
            kind:'timer',
            text: `Reduce the heat slightly and simmer for 3 minutes, stirring occasionally, until liquid is absorbed.`
          },
          {
            id:'serve',
            name:'Stir & serve',
            duration: 0,
            kind:'action',
            text: `Stir, taste, and serve. (Optional: add veggies for extra glory.)`
          }
        ];
      }

      // Microwave
      return [
        {
          id:'dish',
          name:'Microwave-safe dish',
          duration: 0,
          kind:'action',
          text: `Add noodles and sachet contents to a large microwave-safe dish.`
        },
        {
          id:'water',
          name:'Add boiling water',
          duration: 0,
          kind:'action',
          text: `Pour over 300 ml of boiling water and cover the dish.`
        },
        {
          id:'cook',
          name:'Microwave on high',
          duration: 300,
          kind:'timer',
          text: `Cook on high for 5 minutes, stirring occasionally, until liquid is absorbed.`
        },
        {
          id:'serve',
          name:'Stir & serve',
          duration: 0,
          kind:'action',
          text: `Stir and serve. Congratulations. You have mastered ‚Äúno pot‚Äù.`
        }
      ];
    }

    function renderSteps(){
      stepper.innerHTML = '';
      const steps = state.steps;
      for(let i=0;i<steps.length;i++){
        const s = steps[i];
        const el = document.createElement('div');
        el.className = 'step';
        if(i < state.stepIndex) el.classList.add('done');
        if(i === state.stepIndex) el.classList.add('current');

        const hd = document.createElement('div');
        hd.className = 'stephd';

        const left = document.createElement('div');
        left.innerHTML = `<div class="title">${i+1}. ${escapeHtml(s.name)}</div><div class="tiny muted">${s.kind==='timer' ? `‚è±Ô∏è Timed: ${fmt(s.duration)}` : '‚úÖ Action step'}</div>`;

        const right = document.createElement('div');
        const badge = document.createElement('div');
        badge.className = 'badge ' + (i < state.stepIndex ? 'good' : (i===state.stepIndex ? '' : ''));
        badge.textContent = i < state.stepIndex ? 'Done' : (i===state.stepIndex ? 'Now' : 'Next');
        right.appendChild(badge);

        hd.appendChild(left);
        hd.appendChild(right);

        const d = document.createElement('div');
        d.className = 'desc';
        d.textContent = s.text;

        const jump = document.createElement('div');
        jump.className = 'row';
        jump.style.justifyContent = 'space-between';
        jump.style.alignItems = 'center';

        const mini = document.createElement('div');
        mini.className = 'tiny muted';
        mini.textContent = s.kind==='timer' ? 'Tip: You can pause the timer.' : 'Tip: Hit Skip to move on.';

        const go = document.createElement('button');
        go.className = 'ghost';
        go.style.padding = '10px 12px';
        go.textContent = (i===state.stepIndex) ? 'Focus this step' : 'Jump here';
        go.addEventListener('click', () => {
          stopTimer();
          state.stepIndex = i;
          syncActiveStep();
          toastMsg(`Jumped to step ${i+1}`);
        });

        jump.appendChild(mini);
        jump.appendChild(go);

        el.appendChild(hd);
        el.appendChild(d);
        el.appendChild(jump);
        stepper.appendChild(el);
      }

      const total = steps.reduce((sum,s)=>sum+(s.kind==='timer'?s.duration:0),0);
      totalTimeBadge.textContent = `Total: ${fmt(total)}`;
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    function syncActiveStep(){
      const steps = state.steps;
      const s = steps[state.stepIndex];

      if(!s){
        statusBadge.textContent = 'Waiting‚Ä¶';
        activeStepName.textContent = 'No steps yet';
        timeEl.textContent = '00:00';
        activeTip.textContent = 'Build steps to begin.';
        progressBar.style.width = '0%';
        startPauseBtn.disabled = true;
        skipBtn.disabled = true;
        restartBtn.disabled = true;
        renderSteps();
        return;
      }

      statusBadge.textContent = `Step ${state.stepIndex+1}/${steps.length}`;
      activeStepName.textContent = s.name;
      activeTip.textContent = s.text;

      // If timer step and we haven't set remaining for it, initialise.
      if(s.kind === 'timer'){
        if(state.duration !== s.duration || state.remaining<=0 || !state.running){
          state.duration = s.duration;
          if(!state.running) state.remaining = s.duration;
        }
        timeEl.textContent = fmt(state.remaining);
        startPauseBtn.disabled = false;
        restartBtn.disabled = false;
      } else {
        state.duration = 0;
        state.remaining = 0;
        timeEl.textContent = '‚Äî';
        startPauseBtn.disabled = true;
        restartBtn.disabled = true;
      }

      skipBtn.disabled = false;
      startPauseBtn.textContent = state.running ? '‚è∏ Pause' : '‚ñ∂ Start';
      updateProgressBar();
      renderSteps();
    }

    function updateProgressBar(){
      if(state.duration <= 0){
        progressBar.style.width = '0%';
        return;
      }
      const pct = 100 * (1 - (state.remaining / state.duration));
      progressBar.style.width = Math.max(0, Math.min(100, pct)) + '%';
    }

    function nextStep(){
      stopTimer();
      state.stepIndex++;
      if(state.stepIndex >= state.steps.length){
        statusBadge.textContent = 'DONE üéâ';
        activeStepName.textContent = 'You did it.';
        timeEl.textContent = 'üçú';
        activeTip.textContent = 'Stir once more and enjoy. No reheating (and please don‚Äôt drink the sauce sachet).';
        progressBar.style.width = '100%';
        startPauseBtn.disabled = true;
        skipBtn.disabled = true;
        restartBtn.disabled = true;
        spawnConfetti();
        beep('done');
        toastMsg('Pot noodle: completed. Legend status: unlocked.');
        renderSteps();
        return;
      }
      // Initialise next step timer if needed.
      const s = state.steps[state.stepIndex];
      if(s.kind==='timer'){
        state.duration = s.duration;
        state.remaining = s.duration;
      }
      syncActiveStep();
      if(s.kind==='timer') toastMsg('Timer step ready. Hit Start.');
      else toastMsg('Action step: do the thing, then hit Skip.');
    }

    function startTimer(){
      const s = state.steps[state.stepIndex];
      if(!s || s.kind !== 'timer') return;
      if(state.running) return;

      state.running = true;
      startPauseBtn.textContent = '‚è∏ Pause';
      statusBadge.textContent = `Step ${state.stepIndex+1}/${state.steps.length} ‚Ä¢ running`;

      let last = performance.now();
      state.tickHandle = setInterval(() => {
        const now = performance.now();
        const dt = (now - last) / 1000;
        last = now;
        state.remaining -= dt;

        if(state.remaining <= 0){
          state.remaining = 0;
          timeEl.textContent = fmt(0);
          updateProgressBar();
          stopTimer(true);
          beep('done');
          toastMsg('Timer done! Next step‚Ä¶');
          nextStep();
          return;
        }

        timeEl.textContent = fmt(state.remaining);
        updateProgressBar();
      }, 120);
    }

    function stopTimer(finished=false){
      if(state.tickHandle){
        clearInterval(state.tickHandle);
        state.tickHandle = null;
      }
      state.running = false;
      startPauseBtn.textContent = '‚ñ∂ Start';
      if(!finished) updateProgressBar();
    }

    function restartStep(){
      const s = state.steps[state.stepIndex];
      if(!s || s.kind !== 'timer') return;
      stopTimer();
      state.duration = s.duration;
      state.remaining = s.duration;
      timeEl.textContent = fmt(state.remaining);
      updateProgressBar();
      toastMsg('Step restarted. You‚Äôve got this.');
    }

    function buildSteps(){
      const p = currentProduct();
      const steps = stepsFor(p, state.method);
      state.steps = steps;
      state.stepIndex = 0;
      state.running = false;
      state.remaining = 0;
      state.duration = 0;
      stopTimer();
      // Prime active step
      const s0 = steps[0];
      if(s0 && s0.kind==='timer'){
        state.duration = s0.duration;
        state.remaining = s0.duration;
      }
      syncActiveStep();
      toastMsg('Steps built. Let‚Äôs cook.');
    }

    function randomProduct(){
      const p = PRODUCTS[Math.floor(Math.random()*PRODUCTS.length)];
      state.productId = p.id;
      state.method = p.defaultMethod;
      // Random texture for extra chaos
      setTexture(['sloppy','classic','dry'][Math.floor(Math.random()*3)]);
      flavourSel.value = state.productId;
      buildMethodButtons();
      updateHints();
      buildSteps();
    }

    function resetAll(){
      stopTimer();
      state = {
        ...state,
        productId: PRODUCTS[0].id,
        method: PRODUCTS[0].defaultMethod,
        texture: 'sloppy',
        steps: [],
        stepIndex: 0,
        running: false,
        remaining: 0,
        duration: 0,
        knob: 50,
      };
      flavourSel.value = state.productId;
      sauceKnob.value = String(state.knob);
      setTexture('sloppy');
      buildMethodButtons();
      updateHints();
      syncActiveStep();
      toastMsg('Reset complete. Fresh pot energy.');
    }

    // --- events ---
    function init(){
      // Fill dropdown
      for(const p of PRODUCTS){
        const opt = document.createElement('option');
        opt.value = p.id;
        opt.textContent = p.name;
        flavourSel.appendChild(opt);
      }
      flavourSel.value = state.productId;

      buildMethodButtons();
      updateHints();
      syncActiveStep();

      flavourSel.addEventListener('change', () => {
        stopTimer();
        state.productId = flavourSel.value;
        const p = currentProduct();
        state.method = p.defaultMethod;
        buildMethodButtons();
        updateHints();
        // keep steps until user clicks build (less surprising)
        toastMsg('Selected. Click ‚ÄúBuild my steps‚Äù.');
      });

      methodSeg.addEventListener('click', () => {
        // (buttons handle themselves)
        updateHints();
      });

      $$('#textureSeg button').forEach(b => {
        b.addEventListener('click', () => setTexture(b.dataset.texture));
      });

      sauceKnob.addEventListener('input', () => {
        state.knob = Number(sauceKnob.value);
        updateHints();
      });

      buildBtn.addEventListener('click', buildSteps);
      surpriseBtn.addEventListener('click', randomProduct);
      resetAllBtn.addEventListener('click', resetAll);

      startPauseBtn.addEventListener('click', () => {
        const s = state.steps[state.stepIndex];
        if(!s || s.kind!=='timer') return;
        if(state.running){
          stopTimer();
          toastMsg('Paused. Your noodles are on standby.');
        } else {
          startTimer();
          toastMsg('Timer started. Do not blink.');
        }
        syncActiveStep();
      });

      skipBtn.addEventListener('click', () => {
        const s = state.steps[state.stepIndex];
        if(!s) return;
        if(state.running){
          stopTimer();
        }
        beep('skip');
        nextStep();
      });

      restartBtn.addEventListener('click', restartStep);

      muteBtn.addEventListener('click', () => {
        state.muted = !state.muted;
        muteBtn.textContent = state.muted ? 'üîá Sound off' : 'üîä Sound on';
        toastMsg(state.muted ? 'Muted.' : 'Sound on.');
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e) => {
        // ignore typing in select/range
        const t = e.target;
        const isForm = t && (t.tagName==='SELECT' || t.tagName==='INPUT' || t.tagName==='TEXTAREA');
        if(isForm) return;

        if(e.code==='Space'){
          e.preventDefault();
          if(!startPauseBtn.disabled) startPauseBtn.click();
        } else if(e.key==='ArrowRight'){
          if(!skipBtn.disabled) skipBtn.click();
        } else if(e.key.toLowerCase()==='r'){
          if(!restartBtn.disabled) restartBtn.click();
        } else if(e.key.toLowerCase()==='m'){
          muteBtn.click();
        }
      });

      // Little visual for knob
      knobBar.style.width = state.knob + '%';
    }

    init();
  </script>
</body>
</html>
